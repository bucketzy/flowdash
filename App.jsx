[...snipped: your full canvas code will be pasted here dynamically]